<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DOM and Array Event Handler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <!-- Link to CSS -->
     <link rel="stylesheet" href="./Styles.css">

  </head>
  <body>
<!-- Loading screen -->
    <div id="loading" class="loading-screen">
      <div class="spinner"></div>
      <div class="loading-message">Đang tải dữ liệu, vui lòng đợi...</div>
    </div>
    
    <!-- Login section -->
    <div id="loginSection" class="container">
      <div class="card">
        <div class="card-header">
          ĐĂNG NHẬP<br>PHẦN MỀM QUẢN LÝ SỬA CHỮA
        </div>
        <div class="card-body">
          <form id="loginForm">
            <div class="mb-3">
              <label for="username" class="form-label">Tên đăng nhập</label>
              <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3 password-field">
              <label for="password" class="form-label">Mật khẩu</label>
              <input type="password" class="form-control" id="password" required>
              <i class="toggle-password fas fa-eye-slash" onclick="togglePassword()"></i>
            </div>
            <button type="button" class="btn btn-primary w-100" onclick="login()">Đăng nhập</button>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Main application -->
    <div id="mainApp" class="section">
      <!-- Header -->
      <div class="app-header">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-md-8 d-flex align-items-center">
              <img src="https://drive.google.com/thumbnail?id=16gCExt-p9JflHcqZQ2nxWLDL65bpD-Tf&sz=s100" alt="Logo" class="app-logo">
              <span class="app-title">Phần mềm quản lý sửa chữa - Bệnh viện Đa khoa Bắc Giang</span>
            </div>
            <div class="col-md-2 d-none d-md-block">
            </div>
            <div class="col-md-2 text-end">
              <div class="dropdown">
                <div class="user-profile dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  <img id="userAvatar" src="https://drive.google.com/thumbnail?id=1Y2obUC2vpgQLsD1JokCX8QY4olp3LjXe&sz=s100" alt="User Avatar" class="user-avatar">
                  <span id="userName">User Name</span>
                  <i class="fas fa-chevron-down ms-2"></i>
                </div>
                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                  <li><a class="dropdown-item" href="#" onclick="refreshData()"><i class="fas fa-sync-alt me-2"></i>Cập nhật dữ liệu</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editProfileModal"><i class="fas fa-user-edit me-2"></i>Chỉnh sửa thông tin</a></li>
                  <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key me-2"></i>Đổi mật khẩu</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Đăng xuất</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Main content -->
      <div class="container dashboard">
        <div class="row mb-3">
          <div class="col-md-3">
            <button class="btn btn-success w-100" onclick="showAddRepairModal()" data-bs-toggle="modal" data-bs-target="#FormRepairModal">
              <i class="fas fa-plus me-2"></i>Thêm báo hỏng
            </button>
          </div>
          <div class="col-md-2 d-none d-md-block">
          </div>
          <div class="col-md-7">
            <div class="input-group">
              <input type="text" class="form-control" id="searchInput" placeholder="Nhập nội dung tìm kiếm...">
              <button class="btn btn-primary" type="button" onclick="searchRepair()">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
              <button class="btn btn-secondary" type="button" onclick="cancelSearch()">
                <i class="fas fa-times me-2"></i>Hủy tìm kiếm
              </button>
            </div>
          </div>
        </div>
        
        <!-- Tabs -->
        <ul class="nav nav-pills mb-3" id="repairTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-baohong" data-bs-toggle="pill" data-bs-target="#baohong" type="button" role="tab">
              Báo hỏng (0)
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-dangsua" data-bs-toggle="pill" data-bs-target="#dangsua" type="button" role="tab">
              Đang sửa (0)
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-baohanh" data-bs-toggle="pill" data-bs-target="#baohanh" type="button" role="tab">
              Bảo hành (0)
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-suangoai" data-bs-toggle="pill" data-bs-target="#suangoai" type="button" role="tab">
              Sửa ngoài (0)
            </button>
          </li>
        </ul>
        
        <!-- Tab content -->
        <div class="tab-content" id="repairTabsContent">
          <!-- Báo hỏng tab -->
          <div class="tab-pane fade show active" id="baohong" role="tabpanel">
            <table class="custom-table">
              <thead>
                <tr class="tb_header">
                  <th style="width: 5%;">STT</th>
                  <th style="width: 75%;">Nội dung</th>
                  <th style="width: 20%;">Hành động</th>
                </tr>
              </thead>
              <tbody id="history_baohong">
                <!-- Data will be populated dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Đang sửa tab -->
          <div class="tab-pane fade" id="dangsua" role="tabpanel">
            <table class="custom-table">
              <thead>
                <tr class="tb_header">
                  <th style="width: 5%;">STT</th>
                  <th style="width: 75%;">Nội dung</th>
                  <th style="width: 20%;">Hành động</th>
                </tr>
              </thead>
              <tbody id="history_dangsua">
                <!-- Data will be populated dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Bảo hành tab -->
          <div class="tab-pane fade" id="baohanh" role="tabpanel">
            <table class="custom-table">
              <thead>
                <tr class="tb_header">
                  <th style="width: 5%;">STT</th>
                  <th style="width: 75%;">Nội dung</th>
                  <th style="width: 20%;">Hành động</th>
                </tr>
              </thead>
              <tbody id="history_baohanh">
                <!-- Data will be populated dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Sửa ngoài tab -->
          <div class="tab-pane fade" id="suangoai" role="tabpanel">
            <table class="custom-table">
              <thead>
                <tr class="tb_header">
                  <th style="width: 5%;">STT</th>
                  <th style="width: 75%;">Nội dung</th>
                  <th style="width: 20%;">Hành động</th>
                </tr>
              </thead>
              <tbody id="history_suangoai">
                <!-- Data will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Add Repair Modal -->
    <div class="modal fade" id="FormRepairModal" tabindex="-1" aria-labelledby="FormRepairModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">Thêm báo hỏng mới</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addRepairForm">
              <input type="hidden" id="repairId">
              
              <!-- Nhóm Đơn vị yêu cầu -->
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h6 class="mb-0">Thông tin đơn vị yêu cầu</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                          <label for="departmentName" class="me-2 mb-0">Đơn vị yêu cầu:</label>
                          <div class="input-group" style="max-width: 300px;">
                            <span class="input-group-text"><i class="fas fa-hospital"></i></span>
                            <input type="text" class="form-control" id="departmentName" readonly>
                          </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="requesterName" class="form-label">Người yêu cầu</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-user"></i></span>
                          <input type="text" class="form-control" id="requesterName" list="requesterList">
                          <datalist id="requesterList"></datalist>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="requesterPhone" class="form-label">Số điện thoại yêu cầu</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-phone"></i></span>
                          <input type="text" class="form-control" id="requesterPhone" list="phoneList">
                          <datalist id="phoneList"></datalist>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Nhóm Người sửa chữa -->
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h6 class="mb-0">Thông tin người sửa chữa</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="repairPerson" class="form-label">Người sửa chữa</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-user-cog"></i></span>
                          <select class="form-select" id="repairPerson"></select>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="repairPersonPhone" class="form-label">Số điện thoại người sửa chữa</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-phone-alt"></i></span>
                          <input type="text" class="form-control" id="repairPersonPhone" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Nhóm Thiết bị -->
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h6 class="mb-0">Thông tin thiết bị</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentGroup" class="form-label">Nhóm thiết bị</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-layer-group"></i></span>
                          <select class="form-select" id="equipmentGroup"></select>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentId" class="form-label">Mã thiết bị</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                          <select class="form-select" id="equipmentId"></select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Các trường thông tin thiết bị khác -->
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentName" class="form-label">Tên thiết bị</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-tag"></i></span>
                          <input type="text" class="form-control" id="equipmentName" readonly>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentModel" class="form-label">Model</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
                          <input type="text" class="form-control" id="equipmentModel" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentSerial" class="form-label">Serial</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-qrcode"></i></span>
                          <input type="text" class="form-control" id="equipmentSerial" readonly>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentManufacturer" class="form-label">Hãng sản xuất</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-industry"></i></span>
                          <input type="text" class="form-control" id="equipmentManufacturer" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentYear" class="form-label">Năm sản xuất</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                          <input type="text" class="form-control" id="equipmentYear" readonly>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentUseYear" class="form-label">Năm đưa vào sử dụng</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                          <input type="text" class="form-control" id="equipmentUseYear" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentWarranty" class="form-label">Hạn bảo hành</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-shield-alt"></i></span>
                          <input type="text" class="form-control" id="equipmentWarranty" readonly>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentLocation" class="form-label">Vị trí đặt</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                          <input type="text" class="form-control" id="equipmentLocation" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Nhóm Tình trạng -->
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h6 class="mb-0">Thông tin tình trạng thiết bị</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="equipmentStatus" class="form-label">Tình trạng thiết bị</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-exclamation-triangle"></i></span>
                          <input type="text" class="form-control" id="equipmentStatus" list="statusList">
                          <datalist id="statusList"></datalist>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="priorityLevel" class="form-label">Mức độ yêu cầu</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-flag"></i></span>
                          <select class="form-select" id="priorityLevel"></select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="mb-3">
                        <label for="notes" class="form-label">Ghi chú</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-sticky-note"></i></span>
                          <textarea class="form-control" id="notes" rows="3"></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                <div class="row" id="historySection" style="display: none;">
                  <div class="col-md-12">
                    <div class="mb-3">
                      <label for="history" class="form-label">Lịch sử</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-history"></i></span>
                        <textarea class="form-control" id="history" rows="3"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="button" class="btn btn-primary" onclick="saveRepair()">Lưu</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit User Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">Chỉnh sửa thông tin cá nhân</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="profileName" class="form-label">Tên đơn vị</label>
              <input type="text" class="form-control" id="profileName">
            </div>
            <div class="mb-3">
              <label for="profileEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="profileEmail">
            </div>
            <div class="mb-3">
              <label for="profileLogo" class="form-label">URL Logo (tùy chọn)</label>
              <input type="text" class="form-control" id="profileLogo">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="button" class="btn btn-primary" onclick="saveProfile()">Lưu thay đổi</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">Đổi mật khẩu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3 position-relative">
              <label for="currentPassword" class="form-label">Mật khẩu hiện tại</label>
              <div class="input-group">
                <input type="password" class="form-control" id="currentPassword">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordField('currentPassword')">
                  <i class="fas fa-eye-slash"></i>
                </button>
              </div>
            </div>
            <div class="mb-3 position-relative">
              <label for="newPassword" class="form-label">Mật khẩu mới</label>
              <div class="input-group">
                <input type="password" class="form-control" id="newPassword">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordField('newPassword')">
                  <i class="fas fa-eye-slash"></i>
                </button>
              </div>
            </div>
            <div class="mb-3 position-relative">
              <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
              <div class="input-group">
                <input type="password" class="form-control" id="confirmPassword">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordField('confirmPassword')">
                  <i class="fas fa-eye-slash"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="button" class="btn btn-primary" onclick="saveNewPassword()">Xác nhận</button>
          </div>
        </div>
      </div>
    </div>
      
     <!-- Embed Script -->
    <script src="./main.js"></script>
    <!-- Script of Bootstrap -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js" integrity="sha384-7qAoOXltbVP82dhxHAUje59V5r2YsVfBafyUDxEdApLPmcdhBPg1DKg1ERo0BZlK" crossorigin="anonymous"></script>
  </body>
</html>