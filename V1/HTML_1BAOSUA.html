<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÅO S·ª¨A THI·∫æT B·ªä</title>    
    <!-- Bootstrap CSS (phi√™n b·∫£n 5.1.3) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">

    <!-- Font Awesome (ch·ªâ m·ªôt li√™n k·∫øt) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Th∆∞ vi·ªán jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    
    <!-- Bootstrap JS (phi√™n b·∫£n 5.1.3 t∆∞∆°ng ·ª©ng v·ªõi CSS Bootstrap 5.1.3) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    
    <!-- Th∆∞ vi·ªán SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Th∆∞ vi·ªán FileSaver -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <!-- Th∆∞ vi·ªán giao ti·∫øp script -->
    <script src="https://apis.google.com/js/platform.js"></script>
    <style>
      body {
        background-color: #f8f9fa;
        font-family: Arial, sans-serif;
      }

      .container {
        max-width: 100%;
        margin-top: 20px;
      }
      /* TH√îNG B√ÅO N·∫†P D·ªÆ LI·ªÜU */
    /* V√πng loading */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #f4f4f4;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #ddd;
      border-top-color: #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    .loading-message {
      margin-top: 20px;
      font-size: 16px;
      color: #333;
      text-align: center;
    }
    /* H·ªòP THOAI ƒêƒÇNG NH·∫¨P */
      #loginSection {
        width: 400px;
        margin: 100px auto;
        padding: 20px;
      }
      .card {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border: none;
        padding: 10px;
        /* Th√™m padding ƒë·ªÉ t·∫°o kho·∫£ng c√°ch 10px */
      }

      .card-header {
        background-color: #007bff;
        color: #fff;
        font-size: 1.25rem;
        font-weight: bold;
        text-align: center;
      }

      .password-field {
        position: relative;
      }

      .toggle-password {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        cursor: pointer;
      }

      .section {
        display: none;
        padding: 5px;
      }

      .dashboard {
        margin-left: 10px;
        margin-right: 10px;
        display: none;
      }

      .nav-pills .nav-link.active {
        background-color: #007bff;
        color: #fff;
      }

      .tab-content .tab-pane {
        padding: 15px;
        padding-left: 10px;
        padding-right: 10px;
        border-top: none;
        background-color: #ffffff;
      }

      /* TABLE S·ª¨A CH·ªÆA */
      .custom-table {
        border-collapse: collapse;
        width: 100%;
        border: 1px solid #ddd;
        font-size: 18px;
      }

      .custom-table th,
      .custom-table td {
        text-align: left;
        padding: 12px;
      }

      .custom-table tr {
        border-bottom: 1px solid #ddd;
      }

      .custom-table tr.tb_header,
      .custom-table tr:hover {
        background-color: #f1f1f1;
      }

      /* N√öT ƒêI·ªÄU KHI·ªÇN TRONG B·∫¢NG  */
        .action-buttons button {
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #4CAF50; /* M√†u n·ªÅn xanh cho n√∫t Edit */
            color: white;
            border: none;
        }

        .delete-button {
            background-color: #f44336; /* M√†u n·ªÅn ƒë·ªè cho n√∫t X√≥a */
            color: white;
            border: none;
        }
        /*SPIN WAITING*/
        .modal {
            display: none; /* ·∫®n modal m·∫∑c ƒë·ªãnh */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* N·ªÅn m·ªù */
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .spinner {
            border: 8px solid #f3f3f3; /* M√†u n·ªÅn */
            border-top: 8px solid #3498db; /* M√†u xoay */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px; /* Kho·∫£ng c√°ch gi·ªØa spinner v√† text */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            color: #333;
            font-weight: bold;
        }
    </style>
    <script>
      // N·∫†P D·ªÆ li·ªáu
      var mydata = []
      var mycol =[]
      window.addEventListener('DOMContentLoaded', loadulieuAll); // N·∫°p d·ªØ li·ªáu t·∫•t c·∫£

      function loadulieuAll() {
          google.script.run.withSuccessHandler(function(dataout) {
              const data = JSON.parse(dataout); // Ph√¢n t√≠ch chu·ªói JSON th√†nh ƒë·ªëi t∆∞·ª£ng
              filldata_all(data); // G·ªçi h√†m filldata_all v·ªõi d·ªØ li·ªáu tr·∫£ v·ªÅ
          }).getdata();
      }

      // ƒêI·ªÄN D·ªÆ LI·ªÜU V√ÄO LIST
      function filldata_all(dataout) {
        const loadingScreen = document.getElementById('loading');
        loadingScreen.classList.add('hidden');
        mycol = dataout.mycol;
        mydata = dataout ; 
        const loginForm = document.getElementById('loginSection');
        loginForm.style.display = 'block';
      }
    function reloadData() {
        loadulieuAll(); // G·ªçi l·∫°i h√†m loadulieuAll ƒë·ªÉ n·∫°p l·∫°i d·ªØ li·ªáu t·ª´ Google Apps Script
    }
    function updatetable_baohong() {
      try {
        // L·∫•y b·∫£ng history_baohong theo ID
        const history_baohong = document.getElementById("history_baohong");
        // X√≥a d·ªØ li·ªáu c≈© trong tbody c·ªßa b·∫£ng b√°o h·ªèng
        history_baohong.innerHTML = '';
        // Bi·∫øn ƒë·∫øm STT cho b·∫£ng b√°o h·ªèng
        let stt_baohong = 0;
        // Duy·ªát qua c√°c d√≤ng d·ªØ li·ªáu
        mydata.val_DataSC.slice(1).forEach((item) => {
          const status = item[mycol.DataSC.trangthai]; // Chuy·ªÉn tr·∫°ng th√°i v·ªÅ ch·ªØ th∆∞·ªùng
          // X√°c ƒë·ªãnh b·∫£ng d·ª±a tr√™n tr·∫°ng th√°i
          if (status === 1 && item[mycol.DataSC.iduserdv]?.toLowerCase() === id_user ) {
            // TƒÉng STT cho b·∫£ng b√°o h·ªèng
            stt_baohong++;

            // T·∫°o d√≤ng m·ªõi
            const row = document.createElement("tr");

            // C·ªôt STT
            const cellSTT = document.createElement("td");
            cellSTT.textContent = stt_baohong;

            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            //L·∫•y th√¥ng tin thi·∫øt b·ªã 
            const idthietbi = item[mycol.DataSC.idthietbi];
            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === idthietbi);   
            if (rowsthietbi.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã v·ªõi id: " + idthietbi);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            } 
            const rowthietbi = rowsthietbi[0]
            const idusersua = item[mycol.DataSC.idusersua];
            const rowsnguoisua = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idusersua);   
            if (rowsnguoisua.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi s·ª≠a v·ªõi id: " + idusersua);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            } 
            const rownguoisua = rowsnguoisua[0]
            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            const cellNoiDung = document.createElement("td");
            const content = `‚ö†Ô∏è ${item[mycol.DataSC.id]} üõ†Ô∏è ${item[mycol.DataSC.tinhtrangtbdvbao]} üõ†Ô∏è<br>
    ‚ôüÔ∏è${rowthietbi[mycol.DSThietBi.id]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.DSThietBi]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.model]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.serial]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.nuocsx]}<br>
    üë®‚Äçüîß${rownguoisua[mycol.DSUserSua.DSUserSua]} üìÖ${item[mycol.DataSC.ngaydonvibao]}‚Äã`;
            cellNoiDung.innerHTML = content;

            // C·ªôt H√†nh ƒë·ªông
            const cellHanhDong = document.createElement("td");
            cellHanhDong.classList.add("action-buttons");

            // T·∫°o n√∫t S·ª≠a
            const btnEdit = document.createElement("button");
            btnEdit.classList.add("btn", "btn-primary", "btn-sm");
            btnEdit.setAttribute("onclick", `editreport('${item[mycol.DataSC.id]}')`);
            btnEdit.innerHTML = '<i class="fas fa-edit"></i>';
            btnEdit.id ="btedit_baohong_"+ stt_baohong

            // T·∫°o n√∫t X√≥a
            const btnDelete = document.createElement("button");
            btnDelete.classList.add("btn", "btn-danger", "btn-sm");
            btnDelete.setAttribute("data-id", item[mycol.DataSC.id]);
            btnDelete.setAttribute("onclick", `deleteReport('${item[mycol.DataSC.id]}', this)`);
            btnDelete.innerHTML = '<i class="fas fa-trash"></i>';
            btnDelete.id ="btdelete_baohong_"+ stt_baohong

            // T·∫°o n√∫t m·ªü PDF
            const btnPdf = document.createElement("button");
            btnPdf.classList.add("btn", "btn-secondary", "btn-sm");
            btnPdf.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_pdf]}', '_blank')`);
            btnPdf.innerHTML = '<i class="fas fa-file-pdf"></i>';
            btnPdf.id ="btpdfbaohong_"+ stt_baohong

            // T·∫°o n√∫t m·ªü Word
            const btnWord = document.createElement("button");
            btnWord.classList.add("btn", "btn-info", "btn-sm");
            btnWord.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_word]}', '_blank')`);
            btnWord.innerHTML = '<i class="fas fa-file-word"></i>';
            btnWord.id ="btwordbaohong_"+ stt_baohong

            // Th√™m c√°c n√∫t v√†o DOM
            cellHanhDong.appendChild(btnEdit);
            cellHanhDong.appendChild(btnDelete);
            cellHanhDong.appendChild(btnPdf);
            cellHanhDong.appendChild(btnWord);

            // Th√™m c√°c √¥ v√†o d√≤ng
            row.appendChild(cellSTT);
            row.appendChild(cellNoiDung);
            row.appendChild(cellHanhDong);

            // Th√™m d√≤ng v√†o b·∫£ng b√°o h·ªèng
            history_baohong.appendChild(row);
          }
        });

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng b√°o h·ªèng
        document.getElementById('tab-baohong').textContent = `B√°o h·ªèng (${stt_baohong})`;
      } catch (error) {
        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        showinfor("ƒê√£ x·∫£y ra l·ªói: " + error.message);
      }
    }
    //C·∫≠p nh·∫≠t d·ªØ li·ªáu s·ª≠a ch·ªØa 
  function updatetable_dangsua() {
      try {
        // L·∫•y b·∫£ng history_baohong theo ID
        const history_baohong = document.getElementById("history_dangsua");

        // X√≥a d·ªØ li·ªáu c≈© trong tbody c·ªßa b·∫£ng b√°o h·ªèng
        history_baohong.innerHTML = '';

        // Bi·∫øn ƒë·∫øm STT cho b·∫£ng b√°o h·ªèng
        let stt_baohong = 0;

        // Duy·ªát qua c√°c d√≤ng d·ªØ li·ªáu
        mydata.val_DataSC.slice(1).forEach((item) => {
          const status = item[mycol.DataSC.trangthai]; // Chuy·ªÉn tr·∫°ng th√°i v·ªÅ ch·ªØ th∆∞·ªùng
          // X√°c ƒë·ªãnh b·∫£ng d·ª±a tr√™n tr·∫°ng th√°i
          if (status === 2 && item[mycol.DataSC.iduserdv]?.toLowerCase() === id_user ) {
            // TƒÉng STT cho b·∫£ng b√°o h·ªèng
            stt_baohong++;

            // T·∫°o d√≤ng m·ªõi
            const row = document.createElement("tr");

            // C·ªôt STT
            const cellSTT = document.createElement("td");
            cellSTT.textContent = stt_baohong;

            //L·∫•y th√¥ng tin thi·∫øt b·ªã 
            const idthietbi = item[mycol.DataSC.idthietbi];
            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === idthietbi);   
            const rowthietbi = rowsthietbi[0]
            const idusersua = item[mycol.DSThietBi.idusersua];
            const rowsnguoisua = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idusersua);   
            const rownguoisua = rowsnguoisua[0]
            
            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            const cellNoiDung = document.createElement("td");
            const content = `‚ö†Ô∏è ${item[mycol.DataSC.id]} üõ†Ô∏è ${item[mycol.DataSC.tinhtrangtbdvbao]} üõ†Ô∏è<br>
    ‚ôüÔ∏è${rowthietbi[mycol.DSThietBi.id]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.DSThietBi]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.model]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.serial]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.nuocsx]}<br>
    üë®‚Äçüîß${rownguoisua[mycol.DSUserSua.DSUserSua]} üìÖ${item[mycol.DataSC.ngaydonvibao]}‚Äã`;
            cellNoiDung.innerHTML = content;

            // C·ªôt H√†nh ƒë·ªông
            const cellHanhDong = document.createElement("td");
            cellHanhDong.classList.add("action-buttons");


            // T·∫°o n√∫t m·ªü PDF
            const btnPdf = document.createElement("button");
            btnPdf.classList.add("btn", "btn-secondary", "btn-sm");
            btnPdf.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_pdf]}', '_blank')`);
            btnPdf.innerHTML = '<i class="fas fa-file-pdf"></i>';
            btnPdf.id ="btpdfdangsua_"+ stt_baohong

            // T·∫°o n√∫t m·ªü Word
            const btnWord = document.createElement("button");
            btnWord.classList.add("btn", "btn-info", "btn-sm");
            btnWord.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_word]}', '_blank')`);
            btnWord.innerHTML = '<i class="fas fa-file-word"></i>';
            btnWord.id ="btworddangsua_"+ stt_baohong

            // Th√™m c√°c n√∫t v√†o DOM
            cellHanhDong.appendChild(btnPdf);
            cellHanhDong.appendChild(btnWord);

            // Th√™m c√°c √¥ v√†o d√≤ng
            row.appendChild(cellSTT);
            row.appendChild(cellNoiDung);
            row.appendChild(cellHanhDong);

            // Th√™m d√≤ng v√†o b·∫£ng b√°o h·ªèng
            history_baohong.appendChild(row);
          }
        });

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng b√°o h·ªèng
        document.getElementById('tab-dangsua').textContent = `ƒêang s·ª≠a (${stt_baohong})`;
      } catch (error) {
        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        showinfor("ƒê√£ x·∫£y ra l·ªói: " + error.message);
      }
    }
  function updatetable_baohanh() {
      try {
        // L·∫•y b·∫£ng history_baohong theo ID
        const history_baohong = document.getElementById("history_baohanh");

        // X√≥a d·ªØ li·ªáu c≈© trong tbody c·ªßa b·∫£ng b√°o h·ªèng
        history_baohong.innerHTML = '';

        // Bi·∫øn ƒë·∫øm STT cho b·∫£ng b√°o h·ªèng
        let stt_baohong = 0;

        // Duy·ªát qua c√°c d√≤ng d·ªØ li·ªáu
        mydata.val_DataSC.slice(1).forEach((item) => {
          const status = item[mycol.DataSC.trangthai]; // Chuy·ªÉn tr·∫°ng th√°i v·ªÅ ch·ªØ th∆∞·ªùng
          // X√°c ƒë·ªãnh b·∫£ng d·ª±a tr√™n tr·∫°ng th√°i
          if (status === 3 && item[mycol.DataSC.iduserdv]?.toLowerCase() === id_user ) {
            // TƒÉng STT cho b·∫£ng b√°o h·ªèng
            stt_baohong++;

            // T·∫°o d√≤ng m·ªõi
            const row = document.createElement("tr");

            // C·ªôt STT
            const cellSTT = document.createElement("td");
            cellSTT.textContent = stt_baohong;

            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            //L·∫•y th√¥ng tin thi·∫øt b·ªã 
            const idthietbi = item[mycol.DataSC.idthietbi];
            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === idthietbi);   
            const rowthietbi = rowsthietbi[0]
            if (rowsthietbi.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã v·ªõi id: " + idthietbi);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            }
            const idusersua = item[mycol.DSThietBi.idusersua];
            const rowsnguoisua = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idusersua);   
            const rownguoisua = rowsnguoisua[0]
            if (rowsnguoisua.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi s·ª≠a v·ªõi id: " + idusersua);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            }            
            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            const cellNoiDung = document.createElement("td");
            const content = `‚ö†Ô∏è ${item[mycol.DataSC.id]} üõ†Ô∏è ${item[mycol.DataSC.tinhtrangtbdvbao]} üõ†Ô∏è<br>
    ‚ôüÔ∏è${rowthietbi[mycol.DSThietBi.id]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.DSThietBi]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.model]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.serial]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.nuocsx]}<br>
    üë®‚Äçüîß${rownguoisua[mycol.DSUserSua.DSUserSua]} üìÖ${item[mycol.DataSC.ngaydonvibao]}‚Äã`;
            cellNoiDung.innerHTML = content;

            // C·ªôt H√†nh ƒë·ªông
            const cellHanhDong = document.createElement("td");
            cellHanhDong.classList.add("action-buttons");


            // T·∫°o n√∫t m·ªü PDF
            const btnPdf = document.createElement("button");
            btnPdf.classList.add("btn", "btn-secondary", "btn-sm");
            btnPdf.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_pdf]}', '_blank')`);
            btnPdf.innerHTML = '<i class="fas fa-file-pdf"></i>';
            btnPdf.id ="btpdfbaohanh_"+ stt_baohong

            // T·∫°o n√∫t m·ªü Word
            const btnWord = document.createElement("button");
            btnWord.classList.add("btn", "btn-info", "btn-sm");
            btnWord.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_word]}', '_blank')`);
            btnWord.innerHTML = '<i class="fas fa-file-word"></i>';
            btnWord.id ="btwordbaohanh_"+ stt_baohong

            // Th√™m c√°c n√∫t v√†o DOM
            cellHanhDong.appendChild(btnPdf);
            cellHanhDong.appendChild(btnWord);

            // Th√™m c√°c √¥ v√†o d√≤ng
            row.appendChild(cellSTT);
            row.appendChild(cellNoiDung);
            row.appendChild(cellHanhDong);

            // Th√™m d√≤ng v√†o b·∫£ng b√°o h·ªèng
            history_baohong.appendChild(row);
          }
        });

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng b√°o h·ªèng
        document.getElementById('tab-baohanh').textContent = `B·∫£o h√†nh (${stt_baohong})`;
      } catch (error) {
        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        showinfor("ƒê√£ x·∫£y ra l·ªói: " + error.message);
      }
    }
    //S·ª≠a ngo√†i
  function updatetable_suangoai() {
      try {
        // L·∫•y b·∫£ng history_baohong theo ID
        const history_baohong = document.getElementById("history_s·ª≠a ngo√†i");

        // X√≥a d·ªØ li·ªáu c≈© trong tbody c·ªßa b·∫£ng b√°o h·ªèng
        history_baohong.innerHTML = '';

        // Bi·∫øn ƒë·∫øm STT cho b·∫£ng b√°o h·ªèng
        let stt_baohong = 0;

        // Duy·ªát qua c√°c d√≤ng d·ªØ li·ªáu
        mydata.val_DataSC.slice(1).forEach((item) => {
          const status = item[mycol.DataSC.trangthai]; // Chuy·ªÉn tr·∫°ng th√°i v·ªÅ ch·ªØ th∆∞·ªùng

          // X√°c ƒë·ªãnh b·∫£ng d·ª±a tr√™n tr·∫°ng th√°i
          if (status === 4 && item[mycol.DataSC.iduserdv]?.toLowerCase() === id_user ) {
            // TƒÉng STT cho b·∫£ng b√°o h·ªèng
            stt_baohong++;

            // T·∫°o d√≤ng m·ªõi
            const row = document.createElement("tr");

            // C·ªôt STT
            const cellSTT = document.createElement("td");
            cellSTT.textContent = stt_baohong;

            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            //L·∫•y th√¥ng tin thi·∫øt b·ªã 
            const idthietbi = item[mycol.DataSC.idthietbi];
            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === idthietbi);   
            if (rowsthietbi.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã v·ªõi id: " + idthietbi);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            }   
            const rowthietbi = rowsthietbi[0]
            const idusersua = item[mycol.DSThietBi.idusersua];
            const rowsnguoisua = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idusersua);   
            const rownguoisua = rowsnguoisua[0]
            if (rowsnguoisua.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi s·ª≠a v·ªõi id: " + idusersua);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            }  
            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            const cellNoiDung = document.createElement("td");
            const content = `‚ö†Ô∏è ${item[mycol.DataSC.id]} üõ†Ô∏è ${item[mycol.DataSC.tinhtrangtbdvbao]} üõ†Ô∏è<br>
    ‚ôüÔ∏è${rowthietbi[mycol.DSThietBi.id]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.DSThietBi]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.model]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.serial]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.nuocsx]}<br>
    üë®‚Äçüîß${rownguoisua[mycol.DSUserSua.DSUserSua]} üìÖ${item[mycol.DataSC.ngaydonvibao]}‚Äã`;
            cellNoiDung.innerHTML = content;

            // C·ªôt H√†nh ƒë·ªông
            const cellHanhDong = document.createElement("td");
            cellHanhDong.classList.add("action-buttons");


            // T·∫°o n√∫t m·ªü PDF
            const btnPdf = document.createElement("button");
            btnPdf.classList.add("btn", "btn-secondary", "btn-sm");
            btnPdf.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_pdf]}', '_blank')`);
            btnPdf.innerHTML = '<i class="fas fa-file-pdf"></i>';
            btnPdf.id ="btpdfbaohanh_"+ stt_baohong

            // T·∫°o n√∫t m·ªü Word
            const btnWord = document.createElement("button");
            btnWord.classList.add("btn", "btn-info", "btn-sm");
            btnWord.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_word]}', '_blank')`);
            btnWord.innerHTML = '<i class="fas fa-file-word"></i>';
            btnWord.id ="btwordbaohanh_"+ stt_baohong

            // Th√™m c√°c n√∫t v√†o DOM
            cellHanhDong.appendChild(btnPdf);
            cellHanhDong.appendChild(btnWord);

            // Th√™m c√°c √¥ v√†o d√≤ng
            row.appendChild(cellSTT);
            row.appendChild(cellNoiDung);
            row.appendChild(cellHanhDong);

            // Th√™m d√≤ng v√†o b·∫£ng b√°o h·ªèng
            history_baohong.appendChild(row);
          }
        });

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng b√°o h·ªèng
        document.getElementById('tab-suangoai').textContent = `S·ª≠a ngo√†i (${stt_baohong})`;
      } catch (error) {
        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        showinfor("ƒê√£ x·∫£y ra l·ªói: " + error.message);
      }
    }

    function updatetable_all() {
      try {
        // L·∫•y c√°c b·∫£ng theo ID
        const history_baohong = document.getElementById("history_baohong");
        const history_dangsua = document.getElementById("history_dangsua");
        const history_baohanh = document.getElementById("history_baohanh");
        const history_suangoai = document.getElementById("history_suangoai");

        // Ki·ªÉm tra s·ª± t·ªìn t·∫°i c·ªßa b·∫£ng
        if (!history_baohong || !history_dangsua || !history_baohanh || !history_suangoai) {
          showinfor("Kh√¥ng t√¨m th·∫•y b·∫£ng trong giao di·ªán.");
          return;
        }

        // X√≥a d·ªØ li·ªáu c≈© trong tbody
        history_baohong.innerHTML = '';
        history_dangsua.innerHTML = '';
        history_baohanh.innerHTML = '';
        history_suangoai.innerHTML = '';

        // Ki·ªÉm tra d·ªØ li·ªáu
        if (!mydata.val_DataSC || mydata.val_DataSC.length <= 1) {
          history_baohong.innerHTML = '<tr><td colspan=3>Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
          history_dangsua.innerHTML = '<tr><td colspan=3>Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
          history_baohanh.innerHTML = '<tr><td colspan=3>Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
          history_suangoai.innerHTML = '<tr><td colspan=3>Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
          return;
        }

        // Bi·∫øn ƒë·∫øm STT
        const stt = {
          baohong: 0,
          dangsua: 0,
          baohanh: 0,
          suangoai: 0
        };

        // Duy·ªát qua c√°c d√≤ng d·ªØ li·ªáu
        mydata.val_DataSC.slice(1).forEach((item) => {
          const status = item[mycol.DataSC.trangthai];
          let targetTable, currentSTTKey;
          if (item[mycol.DataSC.iduserdv]?.toLowerCase() === id_user) {
            if (status === 1) {
              targetTable = history_baohong;
              currentSTTKey = "baohong";
            } else if (status === 2) {
              targetTable = history_dangsua;
              currentSTTKey = "dangsua";
            } else if (status === 3) {
              targetTable = history_baohanh;
              currentSTTKey = "baohanh";
            } else if (status === 4) {
              targetTable = history_suangoai;
              currentSTTKey = "suangoai";
            } else {
              return;
            }
          }

          if (!targetTable) return;

          stt[currentSTTKey]++;

          // T·∫°o d√≤ng m·ªõi
          const row = document.createElement("tr");

          // C·ªôt STT
          const cellSTT = document.createElement("td");
          cellSTT.textContent = stt[currentSTTKey];

          // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            //L·∫•y th√¥ng tin thi·∫øt b·ªã 
            const idthietbi = item[mycol.DataSC.idthietbi];
            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === idthietbi);   
            if (rowsthietbi.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã v·ªõi id: " + idthietbi);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            } 
            const rowthietbi = rowsthietbi[0]
            const idusersua = item[mycol.DataSC.idusersua];            
            const rowsnguoisua = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idusersua);   
            if (rowsnguoisua.length === 0) {
                showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi s·ª≠a v·ªõi id: " + idusersua);
                return; // Ho·∫∑c x·ª≠ l√Ω logic kh√°c n·∫øu c·∫ßn
            } 
            const rownguoisua = rowsnguoisua[0]
            // C·ªôt N·ªôi dung (v√≠ d·ª•: t√™n thi·∫øt b·ªã)
            const cellNoiDung = document.createElement("td");
            const content = `‚ö†Ô∏è ${item[mycol.DataSC.id]} üõ†Ô∏è ${item[mycol.DataSC.tinhtrangtbdvbao]} üõ†Ô∏è<br>
    ‚ôüÔ∏è${rowthietbi[mycol.DSThietBi.id]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.tentb]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.model]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.serial]}‚öôÔ∏è${rowthietbi[mycol.DSThietBi.nuocsx]}<br>
    üë®‚Äçüîß${rownguoisua[mycol.DSUserSua.hoten]} üìÖ${item[mycol.DataSC.ngaydonvibao]}‚Äã`;
            cellNoiDung.innerHTML = content;

          // C·ªôt H√†nh ƒë·ªông
              const cellHanhDong = document.createElement("td");
              cellHanhDong.classList.add("action-buttons");
              if(currentSTTKey === "baohong"){
                // T·∫°o n√∫t S·ª≠a
                const btnEdit = document.createElement("button");
                btnEdit.classList.add("btn", "btn-primary", "btn-sm");
                btnEdit.setAttribute("onclick", `editreport('${item[mycol.DataSC.id]}')`);
                btnEdit.innerHTML = '<i class="fas fa-edit"></i>';

                // T·∫°o n√∫t X√≥a
                const btnDelete = document.createElement("button");
                btnDelete.classList.add("btn", "btn-danger", "btn-sm");
                btnDelete.setAttribute("data-id", item[mycol.DataSC.id]); // Th√™m data-id cho d√≤ng
                btnDelete.setAttribute("onclick", `deleteReport('${item[mycol.DataSC.id]}', this)`);
                btnDelete.innerHTML = '<i class="fas fa-trash"></i>';
                // T·∫°o n√∫t m·ªü PDF v·ªõi URL
        
                const btnPdf = document.createElement("button");
                btnPdf.classList.add("btn", "btn-secondary", "btn-sm");
                // G·∫Øn URL PDF v√†o s·ª± ki·ªán onclick
                btnPdf.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_pdf]}', '_blank')`);
                btnPdf.innerHTML = '<i class="fas fa-file-pdf"></i>';

                // T·∫°o n√∫t m·ªü Word v·ªõi URL
                const btnWord = document.createElement("button");
                btnWord.classList.add("btn", "btn-info", "btn-sm");
                // G·∫Øn URL Word v√†o s·ª± ki·ªán onclick
                btnWord.setAttribute("onclick", `window.open('${item[mycol.DataSC.url_vttb_09_01_word]}', '_blank')`);
                btnWord.innerHTML = '<i class="fas fa-file-word"></i>';

                // Th√™m c√°c n√∫t v√†o DOM
                cellHanhDong.appendChild(btnEdit);
                cellHanhDong.appendChild(btnDelete);
                cellHanhDong.appendChild(btnPdf);
                cellHanhDong.appendChild(btnWord);
              }
          // Th√™m c√°c √¥ v√†o d√≤ng
          row.appendChild(cellSTT);
          row.appendChild(cellNoiDung);
          row.appendChild(cellHanhDong);

          // Th√™m d√≤ng v√†o b·∫£ng t∆∞∆°ng ·ª©ng
          targetTable.appendChild(row);
        });

        // C·∫≠p nh·∫≠t tab s·ªë l∆∞·ª£ng
        document.getElementById('tab-baohong').textContent = `B√°o h·ªèng (${stt.baohong})`;
        document.getElementById('tab-dangsua').textContent = `ƒêang s·ª≠a (${stt.dangsua})`;
        document.getElementById('tab-baohanh').textContent = `B·∫£o h√†nh (${stt.baohanh})`;
        document.getElementById('tab-suangoai').textContent = `S·ª≠a ngo√†i (${stt.suangoai})`;

      } catch (error) {
        console.error("L·ªói khi c·∫≠p nh·∫≠t b·∫£ng:", error);
        showinfor("ƒê√£ x·∫£y ra l·ªói: " + error.message);
      }
    }



    function clearTable(table) {
          while (table.firstChild) {
              table.removeChild(table.firstChild);
          }
      }

        // H√†m ch·ªânh s·ª≠a b√°o s·ª≠a
    function editreport(id) {
        try {
            // G·ªçi Apps Script ƒë·ªÉ l·∫•y d·ªØ li·ªáu t∆∞∆°ng ·ª©ng v·ªõi ID
            google.script.run
                .withSuccessHandler((data) => {
                    try {
                        if (data) {
                            // Ki·ªÉm tra v√† g√°n gi√° tr·ªã v√†o c√°c ph·∫ßn t·ª≠ HTML
                            const cb_mathietbi = document.getElementById("cb_mathietbi");
                            const cb_nhomthietbi = document.getElementById("cb_nhomthietbi");
                            const txt_ghichu = document.getElementById("txt_ghichu");
                            const txt_tinhtrang = document.getElementById("txt_tinhtrang");
                            const cb_tinhtrang = document.getElementById("cb_tinhtrang");
                            const cb_nguoisua = document.getElementById("cb_nguoisua");

                            let missingElements = [];
                            if (!cb_mathietbi) missingElements.push("cb_mathietbi");
                            if (!txt_ghichu) missingElements.push("txt_ghichu");
                            if (!txt_tinhtrang) missingElements.push("txt_tinhtrang");
                            if (!cb_nguoisua) missingElements.push("cb_nguoisua");
                            if (!cb_tinhtrang) missingElements.push("cb_tinhtrang");
                            if (!cb_nhomthietbi) missingElements.push("cb_nhomthietbi");

                            if (missingElements.length > 0) {
                                // Th√¥ng b√°o ph·∫ßn t·ª≠ n√†o kh√¥ng t√¨m th·∫•y
                                alert("Kh√¥ng t√¨m th·∫•y c√°c ph·∫ßn t·ª≠ sau: " + missingElements.join(", "));
                                return; // D·ª´ng h√†m n·∫øu thi·∫øu ph·∫ßn t·ª≠
                            }
                            var mathietbi =  data[mycol.DataSC.idthietbi]
                            const rowsthietbi = mydata.val_dsthietbi.filter(item => item[mycol.DSThietBi.id] === mathietbi); 
                            var rowthietbi = rowsthietbi[0]
                            // G√°n gi√° tr·ªã t·ª´ d·ªØ li·ªáu v√†o c√°c ph·∫ßn t·ª≠
                            txt_tinhtrang.value = data[mycol.DataSC.tinhtrangtbdvbao];
                            cb_nguoisua.value = data[mycol.DataSC.idusersua];
                            cb_tinhtrang.value = data[mycol.DataSC.mucdo];           
                            txt_ghichu.value = data[mycol.DataSC.ghichu];
                            cb_nhomthietbi.value = rowthietbi[mycol.DSThietBi.nhomtb];
                            //N·∫°p l·∫°i nh√≥m thi·∫øt b·ªã 
                            updateMaThietBi(cb_nhomthietbi.value)
                            cb_mathietbi.value = mathietbi;
                            showDeviceDetails(mathietbi);
                            id_sc = data[mycol.DataSC.id]; // S·ª≠ d·ª•ng let thay v√¨ const
                            // Chuy·ªÉn sang ch·∫ø ƒë·ªô ch·ªânh s·ª≠a
                            editMode(true);
                            (true);
                        } else {
                            showwarning("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho ID n√†y.");
                        }
                    } catch (innerErr) {
                        console.error("L·ªói trong qu√° tr√¨nh x·ª≠ l√Ω d·ªØ li·ªáu:", innerErr.message);
                        showwarning("ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh x·ª≠ l√Ω d·ªØ li·ªáu: " + innerErr.message);
                    }
                })
                .withFailureHandler((error) => {
                    showwarning("C√≥ l·ªói x·∫£y ra khi g·ªçi Apps Script: " + error);
                })
                .SC_getDataById(id); // G·ªçi Apps Script v·ªõi ID
        } catch (err) {
            console.error("L·ªói khi th·ª±c thi editreport:", err.message);
            showwarning("ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh x·ª≠ l√Ω: " + err.message);
        }
    }



        // H√†m x√≥a b√°o s·ª≠a
      function deleteReport(id, btn) {
          showyesno("B·∫°n c√≥ mu·ªën x√≥a d·ªØ li·ªáu s·ª≠a ch·ªØa c√≥ ID " + id + " kh√¥ng?", "X√≥a d·ªØ li·ªáu").then((rs) => {
              if (rs === 1) {
                  google.script.run
                      .withSuccessHandler((result) => {
                          if (result === true) {
                              // X√≥a d√≤ng trong b·∫£ng HTML
                              const row = btn.closest("tr");
                              const table = row.closest("table");

                              if (!table) {
                                  console.error("Kh√¥ng t√¨m th·∫•y b·∫£ng ch·ª©a d√≤ng c·∫ßn x√≥a.");
                                  return;
                              }

                              row.remove(); // X√≥a d√≤ng

                              // ƒê√°nh l·∫°i s·ªë th·ª© t·ª±
                              const rows = table.querySelectorAll("tbody tr"); // L·∫•y t·∫•t c·∫£ c√°c d√≤ng c√≤n l·∫°i trong b·∫£ng
                              rows.forEach((tr, index) => {
                                  const sttCell = tr.querySelector("td:first-child"); // L·∫•y √¥ STT (c·ªôt 1)
                                  if (sttCell) {
                                      sttCell.textContent = index + 1; // C·∫≠p nh·∫≠t STT (b·∫Øt ƒë·∫ßu t·ª´ 1)
                                  }
                              });

                              // C·∫≠p nh·∫≠t l·∫°i s·ªë l∆∞·ª£ng cho tab t∆∞∆°ng ·ª©ng
                              const tableId = table.id;
                              let count = rows.length;

                              if (tableId === "history_baohong") {
                                  document.getElementById('tab-baohong').textContent = `B√°o h·ªèng (${count})`;
                              } else if (tableId === "history_dangsua") {
                                  document.getElementById('tab-dangsua').textContent = `ƒêang s·ª≠a (${count})`;
                              } else if (tableId === "history_baohanh") {
                                  document.getElementById('tab-baohanh').textContent = `B·∫£o h√†nh (${count})`;
                              } else if (tableId === "history_suangoai") {
                                  document.getElementById('tab-suangoai').textContent = `S·ª≠a ngo√†i (${count})`;
                              }
                          } else {
                              alert("Kh√¥ng th·ªÉ x√≥a d√≤ng. ƒê√£ c√≥ l·ªói x·∫£y ra.");
                          }
                      })
                      .withFailureHandler((error) => {
                          alert("C√≥ l·ªói x·∫£y ra khi g·ªçi Apps Script: " + error);
                      })
                      .SC_delete(id); // G·ªçi h√†m Apps Script
              }
          });
      }



    //H√ÄM M·ªû PDF V·∫¨T T∆Ø THI·∫æT B·ªä 09
    function open_pdf_0901(idsc) {
      const result = mydata.val_DataSC.find(row => row[mycol.DataSC.id] === idsc);
    }
    function open_word_0901(idsc) {
      const result = mydata.val_DataSC.find(row => row[mycol.DataSC.id] === idsc);
    }
    //Ch·ªçn ng∆∞·ªùi s·ª≠a 
      function update_nguoisua(idnguoisua) {        
        var cb_nguoisua = document.getElementById("cb_nguoisua");
        var selectedOption = cb_nguoisua.options[cb_nguoisua.selectedIndex];
        var txt_sdt = document.getElementById("txt_sdt_nguoisua");
        // // L·ªçc c√°c m√£ thi·∫øt b·ªã theo nh√≥m thi·∫øt b·ªã ƒë√£ ch·ªçn
        const filteredData = mydata.val_DSUserSua.filter(item => item[mycol.DSUserSua.id] === idnguoisua);          
          // // N·∫øu c√≥ thi·∫øt b·ªã thu·ªôc nh√≥m, th√™m v√†o dropdown
        if (filteredData.length > 0) {
          txt_sdt.value = filteredData[0][mycol.DSUserSua.sdt]
        }
      }
      //Update m√£ thi·∫øt b·ªã 
    function updateMaThietBi(selectedNhomThietBi) {
        var comboBox = document.getElementById("cb_mathietbi");
        comboBox.innerHTML = ''; // X√≥a h·∫øt c√°c l·ª±a ch·ªçn trong comboBox
        var donvi =  document.getElementById("txt_donvi").value;
        // L·ªçc c√°c m√£ thi·∫øt b·ªã theo nh√≥m thi·∫øt b·ªã ƒë√£ ch·ªçn
        const filteredData = mydata.val_dsthietbi.filter(item => 
            item[mycol.DSThietBi.nhomtb] === selectedNhomThietBi && item[mycol.DSThietBi.donvi] === donvi
        );       
        // N·∫øu c√≥ thi·∫øt b·ªã thu·ªôc nh√≥m, th√™m v√†o dropdown
        if (filteredData.length > 0) {
            filteredData.forEach(function(value) {
                var option = document.createElement("option");
                option.text = "["+ value[mycol.DSThietBi.mathietbi] + "] "+ value[mycol.DSThietBi.tentb]; // Gi·∫£ s·ª≠ m√£ thi·∫øt b·ªã l√† ·ªü c·ªôt 2 (index 1)
                option.value = value[mycol.DSThietBi.id]; // G√°n gi√° tr·ªã l√† m√£ thi·∫øt b·ªã
                comboBox.add(option);
            });
            // Sau khi th√™m thi·∫øt b·ªã v√†o dropdown, ch·ªçn thi·∫øt b·ªã ƒë·∫ßu ti√™n
            // comboBox.value = filteredData[0][mycol.DSThietBi.id]; // Ch·ªçn m√£ thi·∫øt b·ªã ƒë·∫ßu ti√™n
            // showDeviceDetails(comboBox.value);  // G·ªçi h√†m showDeviceDetails v·ªõi m√£ thi·∫øt b·ªã ƒë·∫ßu ti√™n
        }
        showDeviceDetails(comboBox.value);  // G·ªçi h√†m showDeviceDetails v·ªõi m√£ thi·∫øt b·ªã ƒë·∫ßu ti√™n
    }

    //onchangeMaThietBi
    function showDeviceDetails(selectedMaThietBi) {
        // Ki·ªÉm tra n·∫øu kh√¥ng ch·ªçn m√£ thi·∫øt b·ªã
        if (!selectedMaThietBi) {
            return;
        }
        // T√¨m thi·∫øt b·ªã theo m√£ thi·∫øt b·ªã ƒë√£ ch·ªçn
        const selectedDevice = mydata.val_dsthietbi.find(item => item[mycol.DSThietBi.id] === selectedMaThietBi);
        // N·∫øu t√¨m th·∫•y thi·∫øt b·ªã, hi·ªÉn th·ªã th√¥ng tin v√†o c√°c textbox
        if (selectedDevice) {
            document.getElementById("txt_tb_ten").value = selectedDevice[mycol.DSThietBi.tentb]; 
            document.getElementById("txt_tb_model").value = selectedDevice[mycol.DSThietBi.model]; 
            document.getElementById("txt_tb_serial").value = selectedDevice[mycol.DSThietBi.serial]; 
            document.getElementById("txt_tb_hang").value = selectedDevice[mycol.DSThietBi.hangsx]; 
            document.getElementById("txt_tb_namsx").value = selectedDevice[mycol.DSThietBi.namsx]; 
            document.getElementById("txt_tb_namsd").value = selectedDevice[mycol.DSThietBi.namsd]; 
            document.getElementById("txt_tb_hanbaohanh").value = selectedDevice[mycol.DSThietBi.hanbaohanh]; 
            document.getElementById("txt_tb_vitridat").value = selectedDevice[mycol.DSThietBi.vitridat]; 
            // B·∫°n c√≥ th·ªÉ th√™m c√°c textbox kh√°c n·∫øu c√≥ th√™m th√¥ng tin t·ª´ c√°c c·ªôt kh√°c
        } else {
            // N·∫øu kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã
            alert("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã!");
        }
    }
    let id_user;
    function login() {
    try {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        if (!username || !password) {
            showwarning("Vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u.");
            return;
        }

        const filteruser = mydata.val_DSUserDV.filter(item => 
            item[mycol.DSUserDV.username].toLowerCase() === username.toLowerCase()
        );

        if (filteruser.length > 0) {
            const user = filteruser[0];
            if (String(user[mycol.DSUserDV.pass]) === password) {
                id_user = user[mycol.DSUserDV.id].toLowerCase()
                // C·∫≠p nh·∫≠t th√¥ng tin ƒëƒÉng nh·∫≠p
                const userFields = {
                    "txt_tendangnhap": user[mycol.DSUserDV.id],
                    "txt_sdt_nguoiyeucau": user[mycol.DSUserDV.sdt],
                    "txt_nguoiyeucau": user[mycol.DSUserDV.hoten],
                    "txt_donvi": user[mycol.DSUserDV.donvi]
                };

                for (const [fieldId, value] of Object.entries(userFields)) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = value;
                    } else {
                        console.warn(`Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ v·ªõi ID: ${fieldId}`);
                    }
                }

                // N·∫°p d·ªØ li·ªáu ng∆∞·ªùi s·ª≠a
                var cb_nguoisua = document.getElementById("cb_nguoisua");
                if (!cb_nguoisua) throw new Error("Kh√¥ng t√¨m th·∫•y dropdown 'cb_nguoisua'.");

                cb_nguoisua.innerHTML = "";

                // Th√™m ng∆∞·ªùi s·ª≠a m·∫∑c ƒë·ªãnh
                var defaultOption = document.createElement("option");
                defaultOption.text = "Vui l√≤ng ch·ªçn ng∆∞·ªùi s·ª≠a";
                defaultOption.value = ""; // Gi√° tr·ªã tr·ªëng
                defaultOption.disabled = true; // Kh√¥ng cho ch·ªçn
                defaultOption.selected = true; // M·∫∑c ƒë·ªãnh ƒë∆∞·ª£c ch·ªçn
                cb_nguoisua.add(defaultOption);

                // var list_nguoisua = user[mycol.DSUserDV.nguoisuachua]; // D·ªØ li·ªáu c·ªßa b·∫°n
                // if (!list_nguoisua) throw new Error("Danh s√°ch ng∆∞·ªùi s·ª≠a ch∆∞a ƒë∆∞·ª£c cung c·∫•p.");

                // var items = list_nguoisua.split(", "); // T√°ch d·ªØ li·ªáu b·∫±ng d·∫•u ph·∫©y v√† kho·∫£ng tr·∫Øng

                // for (var i = 0; i < items.length; i++) {
                //     var option = document.createElement("option");
                //     var iduser = items[i].trim();

                //     // // L·∫•y d·ªØ li·ªáu ng∆∞·ªùi d√πng
                //     // const users_sua = mydata.val_DSUserSua.filter(item => 
                //     //     item[mycol.DSUserSua.id].toLowerCase() === iduser.toLowerCase()
                //     // );

                //     // if (users_sua.length > 0) {
                //     //     option.text = users_sua[0][mycol.DSUserSua.hoten];
                //     //     option.setAttribute("data-phone", users_sua[0][mycol.DSUserSua.sdt]); //
                //     // } else {
                //     //     option.text = iduser;
                //     // }
                //     option.text = users_sua[0][mycol.DSUserSua.hoten];;
                //     option.value = iduser;
                //     cb_nguoisua.add(option); // Th√™m v√†o dropdown
                // }
                mydata.val_DSUserSua.slice(1).forEach((item) => {
                  var option = document.createElement("option");
                  var iduser_sua = item[mycol.DSUserSua.id]
                  var iduser_hoten = item[mycol.DSUserSua.hoten]
                  option.text = iduser_hoten;
                  option.value = iduser_sua;
                  cb_nguoisua.add(option); // Th√™m v√†o dropdown
                })
                if(user[mycol.DSUserDV.nguoisuachua] !== ""){
                  cb_nguoisua.value = user[mycol.DSUserDV.nguoisuachua]
                  update_nguoisua(cb_nguoisua.value);
                }
                
                // L·∫•y dropdown theo ID trong HTML
                var cb_nhomthietbi = document.getElementById("cb_nhomthietbi");
                var cb_mathietbi = document.getElementById("cb_mathietbi");
                var donvi = document.getElementById("txt_donvi").value;
                // var cb_trangthaisc = document.getElementById("cb_trangthaisc");
                cb_nhomthietbi.innerHTML = ""
                cb_mathietbi.innerHTML = ""
                //Th√™m d·ªØ li·ªáu nh√≥m thi·∫øt b·ªã 

                const nhomtb_default = document.createElement("option");
                nhomtb_default.textContent = "--Ch·ªçn nh√≥m thi·∫øt b·ªã--";
                nhomtb_default.value = "";
                cb_nhomthietbi.appendChild(nhomtb_default);

                // L·ªçc v√† th√™m nh√≥m thi·∫øt b·ªã v√†o dropdown
                mydata.val_dsthietbi.forEach(thietbi => {
                  // Ki·ªÉm tra n·∫øu c·ªôt 2 (ƒë∆°n v·ªã) kh·ªõp v·ªõi ƒë∆°n v·ªã hi·ªán t·∫°i
                  if (thietbi[mycol.DSThietBi.donvi] === donvi) {
                    const option = document.createElement("option");
                   
                    option.value = thietbi[mycol.DSThietBi.nhomtb]; // Gi√° tr·ªã cho nh√≥m thi·∫øt b·ªã
                    // Ki·ªÉm tra n·∫øu nh√≥m thi·∫øt b·ªã ƒë√£ t·ªìn t·∫°i trong dropdown (tr√°nh tr√πng l·∫∑p)
                    if (![...cb_nhomthietbi.options].some(opt => opt.value === option.value)) {
                      const rowsnhomthietbi = mydata.val_DSNhomTB.filter(item => item[mycol.DSNhomTB.id] === thietbi[mycol.DSThietBi.nhomtb]);
                      const rownhomthietbi = rowsnhomthietbi[0]   
                      option.textContent ="["+ rownhomthietbi[mycol.DSNhomTB.kihieu]+ "] "+ rownhomthietbi[mycol.DSNhomTB.nhomtb]; // C·ªôt nh√≥m thi·∫øt b·ªã (c·ªôt 3)                      
                      cb_nhomthietbi.appendChild(option);
                    }
                  }
                });
                updateMaThietBi(cb_nhomthietbi.value);
                updatetable_all();
                // Hi·ªÉn th·ªã giao di·ªán dashboard
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("dashboardSection").style.display = "block";
                document.getElementById("WebUI_BaoSua").style.display = "block";
                document.querySelector('.container').classList.add('full-screen-container');
            } else {
                showwarning("M·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p kh√¥ng ch√≠nh x√°c.");
            }
        } else {
            showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o ph√π h·ª£p.");
        }
    } catch (error) {
        showwarning(`ƒê√£ x·∫£y ra l·ªói: ${error.message}`);
        console.error(error); // Ghi l·ªói v√†o console ƒë·ªÉ d·ªÖ ki·ªÉm tra
    }
}

      function togglePassword() {
        const passwordInput = document.getElementById("password");
        const toggleIcon = document.getElementById("togglePasswordIcon");
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          toggleIcon.classList.remove("bi-eye");
          toggleIcon.classList.add("bi-eye-slash");
        } else {
          passwordInput.type = "password";
          toggleIcon.classList.remove("bi-eye-slash");
          toggleIcon.classList.add("bi-eye");
        }
      }

      function showTab(sectionId, tabElement, event) {
          // NgƒÉn tr√¨nh duy·ªát ƒëi·ªÅu h∆∞·ªõng khi nh·∫•n v√†o li√™n k·∫øt
          if (event) event.preventDefault();

          // ·∫®n t·∫•t c·∫£ c√°c tab n·ªôi dung
          document.querySelectorAll('.tab').forEach(section => {
              section.style.display = 'none';
          });

          // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
          document.getElementById(sectionId).style.display = 'block';

          // X√≥a l·ªõp 'active' kh·ªèi t·∫•t c·∫£ c√°c tab
          document.querySelectorAll('.nav-link').forEach(tab => {
              tab.classList.remove('active');
          });

          // Th√™m l·ªõp 'active' v√†o tab hi·ªán t·∫°i
          tabElement.classList.add('active');
      }
      // Hi·ªÉn th·ªã modal "ƒê·ªïi m·∫≠t kh·∫©u"
        function showPasswordResetModal() {
          document.getElementById('passwordResetModal').style.display = 'block';
        }

        // ƒê√≥ng modal "ƒê·ªïi m·∫≠t kh·∫©u"
        function closePasswordResetModal() {
          document.getElementById('passwordResetModal').style.display = 'none';
        }


      function saveNewPassword() {
        var tendangnhap = document.getElementById('txt_username1').value; 
        if(tendangnhap===""){
          showwarning('B·∫°n vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p');
          return;
        }
        var oldPassword = document.getElementById('oldPassword').value;
        if(oldPassword===""){
          showwarning('B·∫°n vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u c≈©');
          return;
        }
        
        var newPassword = document.getElementById('newPassword').value;
        if(newPassword===""){
          showwarning('B·∫°n vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u m·ªõi');
          return;
        }
        var confirmPassword = document.getElementById('confirmPassword').value; 
        if(confirmPassword===""){
          showwarning('B·∫°n vui l√≤ng nh·∫≠p x√°c nh·∫≠n l·∫°i m·∫≠t kh·∫©u m·ªõi');
          return;
        }
        // Ki·ªÉm tra t√≠nh h·ª£p l·ªá
        if (newPassword !== confirmPassword) {
          showwarning('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.');
          return;
        }
        const filteruser = mydata.val_DSUserDV.filter(item => item[mycol.DSUserDV.username] === tendangnhap);          
        if (filteruser.length > 0) {
          var user = filteruser[0]
          if (String(user[mycol.DSUserDV.pass]) === oldPassword) {
              var iduser = user[mycol.DSUserDV.id]
              // G·ª≠i y√™u c·∫ßu t·ªõi Apps Script
              google.script.run
                .withSuccessHandler(function(response) {
                  if (response === true) {
                    showinfor('M·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.');
                  } else {
                    showwarning('C·∫≠p nh·∫≠t m·∫≠t kh·∫©u th·∫•t b·∫°i.');
                  }
                })
                .withFailureHandler(function(error) {
                  showerror('C√≥ l·ªói x·∫£y ra: ' + error.message);
                })
                .usersua_update_password(iduser, newPassword); // Truy·ªÅn userID v√† newPassword v√†o h√†m
            } else {
              showwarning("M·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p kh√¥ng ch√≠nh x√°c");
              return;
            }
        } else {
            showwarning("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o ph√π h·ª£p");
            return;
        }
      }
        // H√†m hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u
        function togglePassword() {
          var passwordField = document.getElementById('password');
          var toggleIcon = document.getElementById('togglePasswordIcon');
          
          if (passwordField.type === "password") {
            passwordField.type = "text";
            toggleIcon.classList.remove("fa-eye");
            toggleIcon.classList.add("fa-eye-slash");
          } else {
            passwordField.type = "password";
            toggleIcon.classList.remove("fa-eye-slash");
            toggleIcon.classList.add("fa-eye");
          }
        }
      // H√†m hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u c≈© trong modal
      function toggleOldPassword() {
        var oldPasswordField = document.getElementById('oldPassword');
        var toggleIcon = document.getElementById('toggleOldPasswordIcon');
        
        if (oldPasswordField.type === "password") {
          oldPasswordField.type = "text";
          toggleIcon.classList.remove("fa-eye");
          toggleIcon.classList.add("fa-eye-slash");
        } else {
          oldPasswordField.type = "password";
          toggleIcon.classList.remove("fa-eye-slash");
          toggleIcon.classList.add("fa-eye");
        }
      }

      // H√†m hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u m·ªõi trong modal
      function toggleNewPassword() {
        var newPasswordField = document.getElementById('newPassword');
        var toggleIcon = document.getElementById('toggleNewPasswordIcon');
        
        if (newPasswordField.type === "password") {
          newPasswordField.type = "text";
          toggleIcon.classList.remove("fa-eye");
          toggleIcon.classList.add("fa-eye-slash");
        } else {
          newPasswordField.type = "password";
          toggleIcon.classList.remove("fa-eye-slash");
          toggleIcon.classList.add("fa-eye");
        }
      }

      // H√†m hi·ªÉn th·ªã/·∫©n x√°c nh·∫≠n m·∫≠t kh·∫©u trong modal
      function toggleConfirmPassword() {
        var confirmPasswordField = document.getElementById('confirmPassword');
        var toggleIcon = document.getElementById('toggleConfirmPasswordIcon');
        
        if (confirmPasswordField.type === "password") {
          confirmPasswordField.type = "text";
          toggleIcon.classList.remove("fa-eye");
          toggleIcon.classList.add("fa-eye-slash");
        } else {
          confirmPasswordField.type = "password";
          toggleIcon.classList.remove("fa-eye-slash");
          toggleIcon.classList.add("fa-eye");
        }
      }
    </script>
  </head>
  <body>
    <!-- N·∫†P D·ªÆ LI·ªÜU -->
    <div class="loading-screen" id="loading">
      <div class="spinner"></div>
      <div class="loading-message">ƒêang n·∫°p d·ªØ li·ªáu, b·∫°n vui l√≤ng ƒë·ª£i trong gi√¢y l√°t nh√©</div>
    </div>
    <!-- ƒêƒÇNG NH·∫¨P -->
    <div class="container">
      <div id="loginSection" class="section" style="display: block;">
        <div class="card">
          <div class="card-header">ƒêƒÉng nh·∫≠p</div>
          <div class="card-body">
            <div class="mb-3">
              <label for="username" class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
                <input type="text" class="form-control" id="username" required>
              </div>
            </div>
            <div class="mb-3 password-field">
              <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                <input type="password" class="form-control" id="password" required>
                <span class="input-group-text" onclick="togglePassword()"><i id="togglePasswordIcon" class="fas fa-eye toggle-password"></i></span>
              </div>
            </div>

            <!-- ƒê·ªïi m·∫≠t kh·∫©u -->
            <div class="mb-3 text-center">
              <a href="javascript:void(0);" onclick="showPasswordResetModal()">ƒê·ªïi m·∫≠t kh·∫©u?</a>
            </div>

            <button class="btn btn-primary w-100" onclick="login()">ƒêƒÉng nh·∫≠p</button>
          </div>
        </div>
      </div>
      <!-- Modal ƒê·ªïi m·∫≠t kh·∫©u -->
      <div id="passwordResetModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="passwordResetModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="passwordResetModalLabel">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closePasswordResetModal()">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="username" class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                  <input type="text" class="form-control" id="txt_username1" required>
                </div>
              </div>
              <div class="mb-3">
                <label for="oldPassword" class="form-label">M·∫≠t kh·∫©u c≈©</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-lock"></i></span>
                  <input type="password" class="form-control" id="oldPassword" required>
                  <span class="input-group-text" onclick="toggleOldPassword()"><i id="toggleOldPasswordIcon" class="fas fa-eye toggle-password"></i></span>
                </div>
              </div>
              <div class="mb-3">
                <label for="newPassword" class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-lock"></i></span>
                  <input type="password" class="form-control" id="newPassword" required>
                  <span class="input-group-text" onclick="toggleNewPassword()"><i id="toggleNewPasswordIcon" class="fas fa-eye toggle-password"></i></span>
                </div>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-lock"></i></span>
                  <input type="password" class="form-control" id="confirmPassword" required>
                  <span class="input-group-text" onclick="toggleConfirmPassword()"><i id="toggleConfirmPasswordIcon" class="fas fa-eye toggle-password"></i></span>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" onclick="closePasswordResetModal()">H·ªßy b·ªè</button>
              <button type="button" class="btn btn-primary" onclick="saveNewPassword()">L∆∞u</button>
            </div>
          </div>
        </div>
      </div>

      <div id="dashboardSection" class="dashboard" style="display: none;">
        <div class="card">
          <div id="WebUI_BaoSua" class="section" style="display: block;">
            <h5>TH√îNG TIN NG∆Ø·ªúI Y√äU C·∫¶U</h5>
            <div class="mb-3 row">
              <label for="tendangnhap" class="col-sm-2 col-form-label">T√™n ƒëƒÉng nh·∫≠p</label>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                  <input type="text" class="form-control" id="txt_tendangnhap" readonly>
                </div>
              </div>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-building"></i></span>
                  <input type="text" class="form-control" id="txt_donvi" readonly>
                </div>
              </div>
            </div>
            <div class="mb-3 row">
              <label for="ho_ten_yeucau" class="col-sm-2 col-form-label">Ng∆∞·ªùi y√™u c·∫ßu</label>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                  <input type="text" class="form-control" id="txt_nguoiyeucau" >
                </div>
              </div>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-phone"></i></span>
                  <input type="text" class="form-control" id="txt_sdt_nguoiyeucau">
                </div>
              </div>
            </div>
          </div>
          <div id="WebUI_NguoiSua" class="section" style="display: block; color: green;">
            <h5>TH√îNG TIN NG∆Ø·ªúI S·ª¨A</h5>
            <div class="mb-3 row">
              <label for="ho_ten_sua" class="col-sm-2 col-form-label">Ng∆∞·ªùi s·ª≠a ch·ªØa</label>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-cogs"></i></span>
                  <select class="form-control" id="cb_nguoisua"  onchange="update_nguoisua(this.value)">
                      <option value="">Ch·ªçn nh√≥m thi·∫øt b·ªã</option>
                  </select>
                </div>
              </div>
              <div class="col-sm-5">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-phone" style="color: green;"></i></span>
                  <input type="text" class="form-control" id="txt_sdt_nguoisua" placeholder="Vui l√≤ng ch·ªçn ng∆∞·ªùi s·ª≠a ch·ªØa" readonly>
                </div>
              </div>
            </div>
          </div>

          <div id="WebUI_Thietbi" class="section" style="display: block;">
            <h5>TH√îNG TIN THI·∫æT B·ªä</h5>
            <div class="mb-3 row">
              <div class="col-sm-6">
                <label for="nhom_thiet_bi" class="form-label">Nh√≥m thi·∫øt b·ªã</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-cogs"></i></span>
                  <select class="form-control" id="cb_nhomthietbi"  onchange="updateMaThietBi(this.value)">
                      <option value="">Ch·ªçn nh√≥m thi·∫øt b·ªã</option>
                  </select>
                </div>
              </div>
              <div class="col-sm-6">
                <label for="maThietBi" class="form-label">M√£ thi·∫øt b·ªã</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                  <select class="form-control" id="cb_mathietbi" onchange="showDeviceDetails(this.value)">
                    <option value="" disabled selected>Ch·ªçn m√£ thi·∫øt b·ªã</option>
                    <option value="">Ch·ªçn m√£ thi·∫øt b·ªã</option>
                    <!-- Th√™m c√°c t√πy ch·ªçn kh√°c t·∫°i ƒë√¢y -->
                  </select>
                </div>
              </div>
            </div>
            <div class="mb-3 row">
              <div class="col-sm-6">
                <label for="tenThietBi" class="form-label">T√™n thi·∫øt b·ªã</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-laptop"></i></span>
                  <input type="text" class="form-control" id="txt_tb_ten" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <label for="model" class="form-label">Model</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-tag"></i></span>
                  <input type="text" class="form-control" id="txt_tb_model" readonly>
                </div>
              </div>
            </div>
            <div class="mb-3 row">
              <div class="col-sm-6">
                <label for="serial" class="form-label">Serial</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                  <input type="text" class="form-control" id="txt_tb_serial" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <label for="hangSanXuat" class="form-label">H√£ng s·∫£n xu·∫•t</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-industry"></i></span>
                  <input type="text" class="form-control" id="txt_tb_hang" readonly>
                </div>
              </div>
            </div>
          <div class="mb-3 row">
            <div class="col-sm-6">
              <label for="namSanXuat" class="form-label">NƒÉm s·∫£n xu·∫•t</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                <input type="text" class="form-control" id="txt_tb_namsx" readonly>
              </div>
            </div>
            <div class="col-sm-6">
              <label for="namSuDung" class="form-label">NƒÉm ƒë∆∞a v√†o s·ª≠ d·ª•ng</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                <input type="text" class="form-control" id="txt_tb_namsd" readonly>
              </div>
            </div>
          </div>
          <div class="mb-3 row">
            <div class="col-sm-6">
              <label for="hanBaoHanh" class="form-label">H·∫°n b·∫£o h√†nh</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-shield-alt"></i></span>
                <input type="text" class="form-control" id="txt_tb_hanbaohanh" readonly>
              </div>
            </div>
            <div class="col-sm-6">
              <label for="viTriDat" class="form-label">V·ªã tr√≠ ƒë·∫∑t</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                <input type="text" class="form-control" id="txt_tb_vitridat" readonly>
              </div>
            </div>
          </div>
          </div>
          <div id="WebUI_Tinhtrang" class="section" style="display: block;">
            <h5>TH√îNG TIN T√åNH TR·∫†NG</h5>
            <div class="mb-3 row">
              <div class="col-sm-6">
                <label for="tinhTrang" class="col-sm-2 col-form-label">M√¥ t·∫£ t√¨nh tr·∫°ng</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
                  <input type="text" class="form-control" id="txt_tinhtrang" placeholder="Nh·∫≠p t√¨nh tr·∫°ng">
                </div>
              </div>
              <div class="col-sm-6">
                <label for="tinhTrangDrop" class="col-sm-2 col-form-label">M·ª©c ƒë·ªô</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                  <select class="form-control" id="cb_tinhtrang" >
                    <option value="" disabled selected>Ch·ªçn ∆∞u ti√™n b√°o h·ªèng</option>
                    <option value=1>01.Th∆∞·ªùng</option>
                    <option value=2>02.G·∫•p</option>
                    <option value=3>03.R·∫•t g·∫•p</option>
                    <!-- Th√™m c√°c t√πy ch·ªçn kh√°c t·∫°i ƒë√¢y -->
                  </select>
                </div>
              </div>
            </div>
            <!-- Ghi ch√∫ n·∫±m ·ªü d√≤ng d∆∞·ªõi c√πng -->
            <div class="mb-3 row">
              <label for="ghichu" class="col-sm-2 col-form-label">Ghi ch√∫</label>
              <div class="col-sm-10">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-sticky-note"></i></span>
                  <input type="text" class="form-control" id="txt_ghichu" placeholder="Nh·∫≠p ghi ch√∫">
                </div>
              </div>
            </div>
          </div>
          <!-- Modal ch·ª©a spinner -->
          <div id="loadingModal" class="modal">
              <div class="modal-content">
                  <div class="spinner"></div>
                  <div class="loading-text">ƒêang l∆∞u d·ªØ li·ªáu, b·∫°n vui l√≤ng ƒë·ª£i trong gi√¢y l√°t nh√©!...</div>
              </div>
          </div>
          <div>
            <!-- N√∫t th√™m b√°o h·ªèng -->
            <button id="bt_sc_new" class="btn btn-danger" style="display: inline-block;" onclick="addErrorReport()">
              <i class="fas fa-plus"></i> Th√™m B√°o H·ªèng
            </button>

            <!-- N√∫t c·∫≠p nh·∫≠t -->
            <button id="bt_sc_edit" class="btn btn-primary" style="display: none;" onclick="updatereport()">
              <i class="fas fa-save"></i> C·∫≠p nh·∫≠t
            </button>

            <!-- N√∫t tho√°t -->
            <button id="bt_sc_close" class="btn btn-secondary" style="display: none;" onclick="exitEditMode()">
              <i class="fas fa-times"></i> Tho√°t
            </button>
          </div>
          <H2> </H2>
          <div id="WebUI_BaoSua" class="section" style="display: block;">
              <h5>L·ªäCH S·ª¨ B√ÅO S·ª¨A</h5>
              <div class="card-body">
                  <!-- Tabs ƒëi·ªÅu h∆∞·ªõng ch√≠nh -->
                  <ul class="nav nav-tabs">
                      <li class="nav-item">
                          <a class="nav-link active" id="tab-baohong" onclick="showTab('WebUI_ds_baohong', this, event)" href="#">B√°o h·ªèng</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" id="tab-dangsua" onclick="showTab('WebUI_ds_dangsua', this, event)" href="#">ƒêang s·ª≠a</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" id="tab-baohanh" onclick="showTab('WebUI_ds_baohanh', this, event)" href="#">B·∫£o h√†nh</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" id="tab-suangoai" onclick="showTab('WebUI_ds_suangoai', this, event)" href="#">S·ª≠a ngo√†i</a>
                      </li>
                  </ul>
                  <br>
                  <!-- N·ªôi dung c·ªßa t·ª´ng tab -->
                  <div id="WebUI_ds_baohong" class="tab" style="display: block;">
                    <table id="table_baohong" class="custom-table">
                      <thead>
                        <tr class="tb_header">
                          <th>STT</th>
                          <th>N·ªôi dung</th>
                          <th>H√†nh ƒë·ªông</th>
                        </tr>
                      </thead>
                      <tbody id="history_baohong">
                          <!-- C√°c d√≤ng l·ªãch s·ª≠ b√°o s·ª≠a s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                      </tbody>
                    </table>
                  </div>

                  <div id="WebUI_ds_dangsua" class="tab" style="display: none;">
                    <table id="table_dangsua" class="custom-table">
                      <thead>
                        <tr class="tb_header">
                          <th>STT</th>
                          <th>N·ªôi dung</th>
                          <th>H√†nh ƒë·ªông</th>
                        </tr>
                      </thead>
                      <tbody id="history_dangsua">
                          <!-- C√°c d√≤ng l·ªãch s·ª≠ b√°o s·ª≠a s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                      </tbody>
                    </table>
                  </div>

                  <div id="WebUI_ds_baohanh" class="tab" style="display: none;">
                    <table id="table_baohanh" class="custom-table">
                      <thead>
                        <tr class="tb_header">
                          <th>STT</th>
                          <th>N·ªôi dung</th>
                          <th>H√†nh ƒë·ªông</th>
                        </tr>
                      </thead>
                      <tbody id="history_baohanh">
                          <!-- C√°c d√≤ng l·ªãch s·ª≠ b√°o s·ª≠a s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                      </tbody>
                    </table>
                  </div>

                  <div id="WebUI_ds_suangoai" class="tab" style="display: none;">
                    <table id="table_suangoai" class="custom-table">
                      <thead>
                        <tr class="tb_header">
                          <th>STT</th>
                          <th>N·ªôi dung</th>
                          <th>H√†nh ƒë·ªông</th>
                        </tr>
                      </thead>
                      <tbody id="history_suangoai">
                          <!-- C√°c d√≤ng l·ªãch s·ª≠ b√°o s·ª≠a s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                      </tbody>
                    </table>
                  </div>
              </div>
          </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        function showLoading() {
            document.getElementById('loadingModal').style.display = 'flex'; // Hi·ªÉn th·ªã modal
        }

        function hideLoading() {
            document.getElementById('loadingModal').style.display = 'none'; // ·∫®n modal
        }



      function addErrorReport() {
          try {
              // L·∫•y d·ªØ li·ªáu t·ª´ c√°c textbox
              var txt_tendangnhap = document.getElementById("txt_tendangnhap");
              var cb_nhomthietbi = document.getElementById("cb_nhomthietbi");
              var cb_mathietbi = document.getElementById("cb_mathietbi");
              var cb_nguoisua = document.getElementById("cb_nguoisua");
              var txt_tinhtrang = document.getElementById("txt_tinhtrang");
              var cb_tinhtrang = document.getElementById("cb_tinhtrang");
              var txt_ghichu = document.getElementById("txt_ghichu");

              var txt_nguoiyeucau = document.getElementById("txt_nguoiyeucau").value;

              // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a ch·ªçn gi√° tr·ªã n√†o (gi√° tr·ªã m·∫∑c ƒë·ªãnh l√† "")
              if (cb_tinhtrang.value === "") {
                  showwarning("Vui l√≤ng ch·ªçn m·ª©c ƒë·ªô ∆∞u ti√™n b√°o h·ªèng.");
                  return false;
              }
              if (!cb_nhomthietbi.value) {
                  showwarning("Vui l√≤ng ch·ªçn nh√≥m thi·∫øt b·ªã");
                  return;
              }
              if (!cb_mathietbi.value) {
                  showwarning("Vui l√≤ng ch·ªçn m√£ thi·∫øt b·ªã");
                  return;
              }
              if (!cb_nguoisua.value) {
                  showwarning("Vui l√≤ng ch·ªçn ng∆∞·ªùi s·ª≠a.");
                  return;
              }
              if (!txt_tinhtrang.value) {
                  showwarning("Vui l√≤ng nh·∫≠p m√¥ t·∫£ t√¨nh tr·∫°ng");
                  return;
              }
            showLoading(); // Hi·ªÉn th·ªã spinner khi b·∫Øt ƒë·∫ßu x·ª≠ l√Ω
              // T·∫°o ƒë·ªëi t∆∞·ª£ng data ƒë·ªÉ l∆∞u th√¥ng tin
            var txt_nguoiyeucau =  document.getElementById("txt_nguoiyeucau");
            var txt_sdt_nguoiyeucau =  document.getElementById("txt_sdt_nguoiyeucau");
            var data = {
                errorID: "1122",                        
                trangThai: 1,                     
                iduserdv: txt_tendangnhap.value,
                hoten: txt_nguoiyeucau.value,
                sdt: txt_sdt_nguoiyeucau.value.toString(),
                idusersua: cb_nguoisua.value,
                ghichu: txt_ghichu.value,
                mucDo: cb_tinhtrang.value,                           
                idthietbi: cb_mathietbi.value,                    
                tinhtrangtbdvbao: txt_tinhtrang.value,
                val_dsthietbi : mydata.val_dsthietbi,
                val_DSUserDV : mydata.val_DSUserDV
            };
              // G·ªçi Apps Script ƒë·ªÉ ghi d·ªØ li·ªáu
              google.script.run
                  .withSuccessHandler(function(dataresponse) {
                      if (dataresponse) {
                          mydata.val_DataSC = dataresponse ;
                          updatetable_all()
                          hideLoading(); 
                          showinfor('ƒê√£ th√™m b√°o h·ªèng th√†nh c√¥ng.');

                      } else {
                          showinfor('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.');
                      }
                  })
                  .withFailureHandler(function(error) {
                    showwarning('L·ªói: ' + error.message);
                  })
                  .SC_thembaohong(data); // S·ª≠ d·ª•ng 'data' thay v√¨ 'databaohong'
          } catch (error) {
              // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu x·∫£y ra l·ªói
              showwarning("ƒê√£ x·∫£y ra l·ªói: " + error.message);
          }
      }
      // N√∫t s·ª≠a
      function editMode(enable) {
        // Hi·ªÉn th·ªã ho·∫∑c ·∫©n c√°c n√∫t theo tr·∫°ng th√°i ch·ªânh s·ª≠a
        document.getElementById("bt_sc_new").style.display = enable ? "none" : "inline-block"; // ·∫®n n√∫t Th√™m
        document.getElementById("bt_sc_edit").style.display = enable ? "inline-block" : "none"; // Hi·ªán n√∫t C·∫≠p nh·∫≠t
        document.getElementById("bt_sc_close").style.display = enable ? "inline-block" : "none"; // Hi·ªán n√∫t Tho√°t
      }
      //c·∫≠p nh·∫≠t 
      let id_sc;
      
      function updatereport() {
        showyesno("B·∫°n c√≥ mu·ªën c·∫≠p nh·∫≠t d·ªØ li·ªáu cho m√£ s·ª≠a ch·ªØa c√≥ ID  [" + id_sc + "] kh√¥ng?", "C·∫≠p nh·∫≠t d·ªØ li·ªáu").then((rs) => {
            if (rs === 1) {
               showLoading(); // Hi·ªÉn th·ªã spinner khi b·∫Øt ƒë·∫ßu x·ª≠ l√Ω
                var inputdata = {
                    id: id_sc, // S·ª≠a t·ª´ = sang :
                    iduserdv: id_user,
                    idthietbi:  document.getElementById("cb_mathietbi").value,
                    idusersua:  document.getElementById("cb_nguoisua").value,
                    tinhtrangtbdvbao: document.getElementById("txt_tinhtrang").value,
                    mucdo: document.getElementById("cb_tinhtrang").value,
                    ghichu: document.getElementById("txt_ghichu").value,
                    val_dsthietbi: mydata.val_dsthietbi,
                    val_DSUserDV: mydata.val_DSUserDV
                };
                google.script.run
                    .withSuccessHandler((result) => {
                        mydata.val_DataSC = result;
                        updatetable_baohong();
                        exitEditMode()
                        hideLoading(); // Hi·ªÉn th·ªã spinner khi b·∫Øt ƒë·∫ßu x·ª≠ l√Ω
                      })
                    .withFailureHandler((error) => {
                        alert("C√≥ l·ªói x·∫£y ra khi g·ªçi Apps Script: " + error);
                    })
                    .SC_update(inputdata); // G·ªçi h√†m Apps Script
            }
        });
      }
      //Ch·∫ø ƒë·ªô edit mod
      function exitEditMode() {
        editMode(false); // Tho√°t ch·∫ø ƒë·ªô ch·ªânh s·ª≠a
      }
      function fetchDeviceInfo() {
        const maThietBi = document.getElementById("maThietBi").value;
        if (maThietBi === "TB001") {
          document.getElementById("tenThietBi").value = "M√°y X-Quang";
          document.getElementById("model").value = "Model A1";
          document.getElementById("serial").value = "SN12345";
          document.getElementById("hangSanXuat").value = "H√£ng XYZ";
          document.getElementById("namSanXuat").value = "2020";
          document.getElementById("namSuDung").value = "2021";
          document.getElementById("hanBaoHanh").value = "2025";
          document.getElementById("viTriDat").value = "Ph√≤ng A";
        } else {
          document.getElementById("tenThietBi").value = "";
          document.getElementById("model").value = "";
          document.getElementById("serial").value = "";
          document.getElementById("hangSanXuat").value = "";
          document.getElementById("namSanXuat").value = "";
          document.getElementById("namSuDung").value = "";
          document.getElementById("hanBaoHanh").value = "";
          document.getElementById("viTriDat").value = "";
        }
      }

        //H√†m hi·ªÉn th·ªã th√¥ng b√°o message box 
        function showerror(message) {
          Swal.fire({
            icon: 'error',
            title: 'Th√¥ng b√°o',
            text: message,
            confirmButtonText: 'ƒê·ªìng √Ω',
          });
        }
        function showwarning(message) {
          Swal.fire({
            icon: 'warning',
            title: 'Th√¥ng b√°o',
            text: message,
            confirmButtonText: 'ƒê·ªìng √Ω',
          });
        }
        function showinfor(message) {
          Swal.fire({
            icon: 'info',
            title: 'Th√¥ng b√°o',
            text: message,
            confirmButtonText: 'ƒê·ªìng √Ω',
          });
        }
        function showsucces(message) {
          Swal.fire({
            icon: 'success',
            title: 'Th√¥ng b√°o',
            text: message,
            confirmButtonText: 'ƒê·ªìng √Ω',
          });
        }
      function showyesno(message, title) {
        return Swal.fire({
          title: title,
          text: message,
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'C√≥',
          cancelButtonText: 'Kh√¥ng',
        }).then((result) => {
          if (result.isConfirmed) {
            return 1;
          } else {
            return 0;
          }
        });
      }

    </script>
  </body>
</html>